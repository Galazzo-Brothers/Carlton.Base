@namespace Carlton.Core.Flux.Components
@inherits ErrorBoundary
@inject ILogger<FluxErrorBoundary> Logger
@inject IFluxExceptionDisplayService ExceptionDisplayService
@inject IComponentExceptionLoggingService ComponentExceptionLoggingService


@if (ShowErrorContent)
{
    @ErrorPrompt(ErrorPromptModel)
}
else
{
    @ChildContent
}

@code {
    [Parameter]
    public RenderFragment<ErrorPromptModel> ErrorPrompt { get; set; }

    //hide the ErrorContent in favor of the new ErrorPrompt
    private new RenderFragment<Exception> ErrorContent { get; set; }

    private bool ShowErrorContent { get => base.CurrentException != null; }

    private ErrorPromptModel ErrorPromptModel { get; set; }

    protected override void OnParametersSet()
    {
        ComponentExceptionLoggingService.LogException(Logger, base.CurrentException);
        base.OnParametersSet();
    }

    protected override Task OnErrorAsync(Exception exception)
    {
        ErrorPromptModel = ExceptionDisplayService.GetErrorPromptModel(exception, base.Recover);
        ComponentExceptionLoggingService.LogException(Logger, exception);
        return base.OnErrorAsync(exception);
    }
}





