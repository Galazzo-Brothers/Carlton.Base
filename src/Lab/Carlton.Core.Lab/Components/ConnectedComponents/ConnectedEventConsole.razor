@using Carlton.Core.Components.Consoles
@namespace Carlton.Core.Lab.Components
@attribute [ObserveStateEvents("EventRecorded")]
@attribute [ObserveStateEvents("EventsCleared")]
@inherits BaseConnectedComponent<EventConsoleViewModel>

<div class="event-console">
    <Console IsReadOnly="true" Text="@RecordedEventsText" />
    <IconAppButton Icon="delete"
                   OnClickCallback="() => base.OnComponentEvent.InvokeAsync(new ClearEventsCommand())" />
</div>

@code {

    private string RecordedEventsText { get; set; }

    protected override void OnParametersSet()
    {
        var consoleText = new StringBuilder();
        foreach(var evt in ViewModel.RecordedEvents)
        {
            var args = (evt.EventObj == null) ? string.Empty : JsonSerializer.Serialize(evt.EventObj);
            consoleText.AppendLine($"{evt.Name}: {args}");
        }
        RecordedEventsText = consoleText.ToString().Trim();
        base.OnParametersSet();
    }
}


